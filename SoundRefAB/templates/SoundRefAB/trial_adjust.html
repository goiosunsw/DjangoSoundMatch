{% extends 'SoundRefAB/base.html' %}

{% load staticfiles %}
<link rel="stylesheet" type="text/css" href="{% static 'SoundRefAB/style.css' %}">


{% block body_block %}

<script type="text/javascript" src="{% static 'SoundRefAB/riffwav.js' %}">

<script type="text/javascript">
   function validateFormOnSubmit(theForm){
       if (theForm.choice.value == "") {
           alert("Please pick a sound!");
           return false;
       }
       if (theForm.valid.value == "0") {
           alert("Please rate before submitting!");
           return false;
       }

       return true;
   }
</script>
   
   
<script type="text/javascript">
   
   function regenSound(val, id) {
       var nharm = {{param_list.0.nharm}};
       var slope = {{param_list.0.slope}};
       var ampl = {{param_list.0.ampl}};
       var dur = {{param_list.0.dur}};
       var freq = {{param_list.0.freq}};
       {{param_list.0.adj_par_name}} = val
       realslope = slope * 6 - 1
       document.getElementById(id).src = GeneratePeriodic(nharm,realslope,ampl,dur,freq);
       return true;
   }
</script>

<script type="text/javascript">
   document.onload = function() {
       regenSound({{param_list.0.ampl}},document.getElementById("audio0"));
       regenSound({{param_list.1.ampl}},document.getElementById("audio1"));
   } ;
</script>


<h1>Sample {{ trial_id }} of {{ n_trials }}</h1>


{% if error_message %}<p><strong>{{ error_message }}</strong></p>{% endif %}
<form action="{% url 'srefab:processadj' sample_id %}" onsubmit="return validateFormOnSubmit(this)" method="post" id="trialForm">
    <input type="hidden" id="valid" value="0">
    <input type="hidden" id="playseq" value="">
    <input type="hidden" id="ampl_list" value="{{ampl_list}}">
    <h2>Adjust the second sound so that it sounds twice as loud as the reference</h2>
    <p>Difficulty level: {{ difficulty }}</p>
    <table border="1px" margin="10px">
        <tr>
            <td>
                <h2>Reference</h2>
                <audio id="audio0" onload="regenSound({{param_list.val0}},this);">
                    Your browser does not support the audio element.
                </audio>
                <script type="text/javascript">
                   function Play0(){
                      var v = document.getElementById("audio0");
                      if(v.src.length<1000){
                          regenSound({{param_list.0.val0}},"audio0");
                          document.getElementById("playseq").value += "0"
                      }
                      v.play();
                   }
                </script>

            <input type="button" onclick="Play0();"  value="Play"/>
            </td>
            <td>
                <h2>Adjust:</h2>
                <audio id="audio1" onload="regenSound({{param_list.val0}},this);">
                    Your browser does not support the audio element.
                </audio>
                <script type="text/javascript">
                   function Play1(){
                      var v = document.getElementById("audio1");
                      if(v.src.length<1000){
                          regenSound(document.getElementById("adjval").value,"audio1");
                          document.getElementById("playseq").value += "1"
                      }
                      v.play();
                   }
                </script>
            <input id="adjval" name="adjval" type="range" style="width:180px"
                min="0" max="1" step=".01" value="{{param_list.val0}}"
                onchange="regenSound(this.value, 'audio1');"/>
				
				<input type="button" onclick="Play1();"  value="Play"/>
        </tr>
    </table>
    <div style="height:20px"></div>
        {% csrf_token %}
        <p>How confident are you of this answer?</p>
        <div>
            <div style="width:200px;float:left">
                <input id="confidence" name="confidence" type="range" style="width:180px"
                min="0" max="3" step="1" value="0"
                oninput="ConfidenceMeaning(this.value)" onchange="ConfidenceMeaning(this.value)"/>
            </div>
            <div style="float:left;color:red" id="confidence_text">Rate me!</div>
        </div>
        <script type="text/javascript">
           function ConfidenceMeaning(val){
              var t = document.getElementById("confidence_text");
              t.style.color="black";
              switch(parseInt(val)){
              case 0:
                  t.innerHTML = 'Not sure at all';
                  document.getElementById("valid").value="1";
                  break;
              case 1:
                  t.innerHTML = 'Somewhat unsure';
                  document.getElementById("valid").value="1";
                  break;
              case 2:
                  t.innerHTML = 'Pretty confident';
                  document.getElementById("valid").value="1";
                  break;
              case 3:
                  t.innerHTML = "I'm sure";
                  document.getElementById("valid").value="1";
                  break;
              default:
                  t.innerHTML = 'oops';

              }
           }
        </script>
           <div style="height:10px;clear:both;"></div>
        <input style="font-size:24;width:100px;height:50px" type="submit" name="submit" value="Submit" />

    </form>
{% endblock %}